\documentclass{minimal}

%
% Dummy definitions to enable load macros
%
\usepackage{fontenc}    
\usepackage{hyperref}
\usepackage{fancyhdr}
\usepackage{ifthen}

\newcounter{year}\setcounter{year}{0}
\newif\ifyearbook
\yearbookfalse

%
% Load useful macros.
%
\usepackage[fykos]{fksmeta}

%
% TeX to text macros
%
\newcommand~{ }
\def\dots{…}%
\def\uv#1{„#1“}%
%TODO resit az nastane
%n,m-das
% &
% %
% @
% #

%
% Redefine problem loading to produce XML fragments
%
\newcounter{batch}\setcounter{batch}{\batchno}
\newcounter{problemcount}\setcounter{problemcount}{\problemcount}
\newcommand{\problemsdir}{../problems}
\newcounter{problem}

\newwrite\tempfile

\newcommand\probbatch[1]{\relax}
\makeatletter
\newcommand\probno[1]{\immediate\write\tempfile{<number>#1</number>}%
\immediate\write\tempfile{<label>\@metaprobletter{#1}</label>}}
\makeatother

\def\xmlWrite#1{\immediate\write\tempfile{#1}}
%\newcommand\probname[2][]{\immediate\write\tempfile{<name>\ifthenelse{\equal{#1}{}}{a}{b}</name>}}

\newcommand\probname[2][]{\ifthenelse{\catcode`$=11\catcode`&=11\catcode`@=11%
\equal{#1}{}}{\immediate\write\tempfile{<name>#2</name>}}{\immediate\write\tempfile{<name>#1</name>}}}
\newcommand\proborigin[1]{\immediate\write\tempfile{<origin><![CDATA[\unexpanded{#1}]]></origin>}}
\newcommand\probpoints[1]{\immediate\write\tempfile{<points>#1</points>}}
\newcommand\probauthors[1]{\immediate\write\tempfile{<authors>#1</authors>}}
\newcommand\probsolauthors[1]{\immediate\write\tempfile{<solution-authors>#1</solution-authors>}}
\newcommand\probstudyyears[1]{\immediate\write\tempfile{<study-years>#1</study-years>}}
\newcommand\probtags[1]{\immediate\write\tempfile{<tags>#1</tags>}}
\newcommand\probsolvers[1]{\relax}
\newcommand\probavg[1]{\relax}
\newcommand\probtask[1]{\immediate\write\tempfile{<task>%
<![CDATA[\unexpanded{#1}]]>%
</task>}}
\newcommand\probsolution[1]{\relax}
\newcommand\probfig[1]{\relax}


\begin{document}

\immediate\openout\tempfile=\jobname.xml

\immediate\write\tempfile{<?xml version="1.0" encoding="utf-8"?>}
\immediate\write\tempfile{<problems deadline="\mdeadline" deadline-post="\mdeadlineS">}

\setcounter{problem}{0}
\loop{
    \stepcounter{problem}
    \immediate\write\tempfile{<problem>}
    \input{\problemsdir/problem\thebatch-\theproblem.tex}
    \immediate\write\tempfile{</problem>}
}\ifnum\theproblem<\theproblemcount
\repeat

\immediate\write\tempfile{</problems>}
\immediate\closeout\tempfile




\end{document}
